import './App.css';
import React, { useState } from 'react';
import axios from 'axios';

const App = () => {
  const [url, SetUrl] = useState('');
  const [scanningResult, setScannedResult] = useState(null);
  const [loadingResult, setLoadingResult] = useState(false);

  const StartingScanning = (event) => {
    event.preventDefault();
    // Sends POST request to node.js and should receive response once completed
    setLoadingResult(true); 
    axios.post('http://localhost:5000/api/startScanning', {url}).then(response => {
      console.log('Received scan results:', response.data);
      setScannedResult(response.data); // Receive response here
      setLoadingResult(false);
    })
    // To catch any error that may occur from sending POST request
    .catch(error => {
      console.error("Error Sending request", error);
      setLoadingResult(false);
    });

  };
  
  return (
    <div className="App">
      <header className="App-header">
        <table>
          <tr>
            <th>Learn Vulnerabilities</th>
            <th>How this Website works</th>
            <th>Your Account</th>
          </tr>
        </table>
      </header>
      <form className="App-form">
        <label>
          Please paste web application link:
          <input type="text" value = {url} placeholder = "Paste in URL" onChange = {event => SetUrl(event.target.value)}/>
        </label>
        <button onClick = {StartingScanning} disabled = {loadingResult}>Start Scan</button>
        {loadingResult && <p>Loading Result...</p>}
        {scanningResult && (
          <div>
            <h1>
              Scanned Results
            </h1>
            <pre>
              {JSON.stringify(scanningResult, null, 2)}
            </pre>
          </div>
        )}
      </form>
    </div>
  );
};

export default App;
